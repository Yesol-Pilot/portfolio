import{r as e,o as v,Z as P,$ as S,p as x,z as y,k as U,e as k,u as I,v as z,j as u,D as C,A as F,l as R}from"./index-LI-KpOx_.js";import{E as T}from"./Environment-5ZIyXIoe.js";import{B as D}from"./Billboard-DKpfDPvD.js";import{T as N}from"./Text-KN1bA1w-.js";import{H as W}from"./Html-DSAyQE1A.js";import{F as B}from"./Float-DG87c6ev.js";import"./deprecated-C8-qPaWV.js";const E=S>=154?"opaque_fragment":"output_fragment";class H extends P{constructor(c){super(c),this.onBeforeCompile=(t,o)=>{const{isWebGL2:m}=o.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${E}>`,`
        ${m?`#include <${E}>`:`#extension GL_OES_standard_derivatives : enable
#include <${E}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${S>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const G=e.forwardRef((d,c)=>{const[t]=e.useState(()=>new H(null));return e.createElement("primitive",v({},d,{object:t,ref:c,attach:"material"}))});let h,M;const $=e.createContext(null),w=new U,j=new k,q=e.forwardRef(({children:d,range:c,limit:t=1e3,...o},m)=>{const r=e.useRef(null);e.useImperativeHandle(m,()=>r.current,[]);const[a,s]=e.useState([]),[[n,i,l]]=e.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);e.useEffect(()=>{r.current.geometry.attributes.position.needsUpdate=!0}),x(()=>{for(r.current.updateMatrix(),r.current.updateMatrixWorld(),w.copy(r.current.matrixWorld).invert(),r.current.geometry.drawRange.count=Math.min(t,c!==void 0?c:t,a.length),h=0;h<a.length;h++)M=a[h].current,M.getWorldPosition(j).applyMatrix4(w),j.toArray(n,h*3),r.current.geometry.attributes.position.needsUpdate=!0,M.matrixWorldNeedsUpdate=!0,M.color.toArray(i,h*3),r.current.geometry.attributes.color.needsUpdate=!0,l.set([M.size],h),r.current.geometry.attributes.size.needsUpdate=!0});const f=e.useMemo(()=>({getParent:()=>r,subscribe:p=>(s(g=>[...g,p]),()=>s(g=>g.filter(b=>b.current!==p.current)))}),[]);return e.createElement("points",v({userData:{instances:a},matrixAutoUpdate:!1,ref:r,raycast:()=>null},o),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:n.length/3,array:n,itemSize:3,usage:y}),e.createElement("bufferAttribute",{attach:"attributes-color",count:i.length/3,array:i,itemSize:3,usage:y}),e.createElement("bufferAttribute",{attach:"attributes-size",count:l.length,array:l,itemSize:1,usage:y})),e.createElement($.Provider,{value:f},d))}),L=e.forwardRef(({children:d,positions:c,colors:t,sizes:o,stride:m=3,...r},a)=>{const s=e.useRef(null);return e.useImperativeHandle(a,()=>s.current,[]),x(()=>{const n=s.current.geometry.attributes;n.position.needsUpdate=!0,t&&(n.color.needsUpdate=!0),o&&(n.size.needsUpdate=!0)}),e.createElement("points",v({ref:s},r),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/m,array:c,itemSize:m,usage:y}),t&&e.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/m,array:t,itemSize:3,usage:y}),o&&e.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/m,array:o,itemSize:1,usage:y})),d)}),O=e.forwardRef((d,c)=>d.positions instanceof Float32Array?e.createElement(L,v({},d,{ref:c})):e.createElement(q,v({},d,{ref:c}))),X=d=>{const[c,t]=e.useState(null),o=e.useRef(null),m=e.useRef(null);return e.useEffect(()=>{let r=!0;const a=()=>{m.current&&m.current.getTracks().forEach(s=>s.stop()),o.current&&o.current.close()};return d==="mic"?(a(),(async()=>{try{const n=await navigator.mediaDevices.getUserMedia({audio:!0});m.current=n;const i=new(window.AudioContext||window.webkitAudioContext);o.current=i;const l=i.createMediaStreamSource(n),f=i.createAnalyser();f.fftSize=256,l.connect(f),r&&t(f)}catch(n){console.error("Mic Error:",n)}})()):(a(),setTimeout(()=>{r&&t(null)},0)),()=>{r=!1,a()}},[d]),c},V=({analyser:d,mode:c})=>{const t=e.useRef(),o=500,[m]=e.useState(()=>{const a=new Float32Array(o*3);for(let s=0;s<o;s++)a[s*3]=(Math.random()-.5)*10,a[s*3+1]=(Math.random()-.5)*5,a[s*3+2]=(Math.random()-.5)*5;return a}),r=e.useMemo(()=>new Uint8Array(128),[]);return x(a=>{if(!t.current)return;let s=0;if(c==="mic"&&d)d.getByteFrequencyData(r),s=r.reduce((l,f)=>l+f,0)/r.length/255;else{const l=a.clock.elapsedTime;s=(Math.sin(l)*.5+.5)*.5}const n=t.current.geometry.attributes.position.array;for(let l=0;l<o;l++){let f=m[l*3],p=m[l*3+1],g=m[l*3+2];const b=1+s*2,A=a.clock.elapsedTime,_=Math.sin(A+f)*.2;n[l*3]=f*b+Math.sin(A*2+p)*.1,n[l*3+1]=p*b+Math.cos(A*1.5+f)*.1,n[l*3+2]=g*b+_}t.current.geometry.attributes.position.needsUpdate=!0;const i=t.current.material;i&&(i.size=.05+s*.2,i.color&&i.color.setHSL(.5+s*.5,1,.5))}),u.jsx(O,{ref:t,positions:m,stride:3,children:u.jsx(G,{transparent:!0,color:"#06b6d4",size:.05,sizeAttenuation:!0,depthWrite:!1,blending:F})})},Y=({analyser:d,mode:c})=>{const t=e.useRef(),o=16,m=.6,r=e.useMemo(()=>new Uint8Array(32),[]);return x(a=>{if(!t.current)return;let s=[];if(c==="mic"&&d)d.getByteFrequencyData(r),s=Array.from(r).slice(0,o);else{const n=a.clock.elapsedTime;for(let i=0;i<o;i++){const l=(Math.sin(n*3+i*.5)+Math.cos(n*2+i*.2))*.5+.5;s.push(l*255)}}t.current.children.forEach((n,i)=>{if(s[i]!==void 0&&n.material){const l=s[i]/255,f=.5+l*5;n.scale.y=R.lerp(n.scale.y,f,.2);const p=.5+l*.3;n.material.color&&n.material.color.setHSL(p,1,.5),n.material.emissive&&n.material.emissive.setHSL(p,1,.2),"emissiveIntensity"in n.material&&(n.material.emissiveIntensity=l*3)}})}),u.jsx("group",{ref:t,position:[-9.6/2,-2,0],children:Array.from({length:o}).map((a,s)=>u.jsxs("mesh",{position:[s*m,2,0],children:[u.jsx("boxGeometry",{args:[.4,1,.4]}),u.jsx("meshStandardMaterial",{color:"#06b6d4",roughness:.2,metalness:.8})]},s))})},Z=({analyser:d,mode:c})=>{const t=e.useRef(),o=e.useMemo(()=>new Uint8Array(64),[]);return x(m=>{if(!t.current)return;let r=0;c==="mic"&&d?(d.getByteFrequencyData(o),r=o.reduce((i,l)=>i+l,0)/o.length/255):r=(Math.sin(m.clock.elapsedTime)*.5+.5)*.6;const a=t.current.geometry.attributes.position,s=m.clock.elapsedTime;for(let i=0;i<a.count;i++){const l=a.getX(i),f=a.getY(i),p=Math.sqrt(l*l+f*f);let g=Math.sin(p*1.5-s*2)*(.2+r*1.5);g+=Math.cos(l*2+s)*.1,a.setZ(i,g)}a.needsUpdate=!0;const n=t.current.material;if(n&&"emissiveIntensity"in n){const i=r*3;n.emissiveIntensity=R.lerp(n.emissiveIntensity,i,.1)}}),u.jsxs("mesh",{ref:t,position:[0,-3,-2],rotation:[-Math.PI/2.5,0,0],children:[u.jsx("planeGeometry",{args:[20,15,32,32]}),u.jsx("meshPhysicalMaterial",{color:"#ec4899",emissive:"#ec4899",emissiveIntensity:.5,wireframe:!0,transparent:!0,opacity:.3,side:C})]})},Q=({analyser:d,mode:c})=>{const t=e.useRef(),o=e.useMemo(()=>new Uint8Array(32),[]);return x(m=>{if(!t.current)return;let r=0;c==="mic"&&d?(d.getByteFrequencyData(o),r=o.slice(0,10).reduce((n,i)=>n+i,0)/10/255):r=(Math.sin(m.clock.elapsedTime*4)*.5+.5)*.8;const a=1+r*.5;t.current.scale.set(a,a,a);const s=t.current.material;s&&(s.emissiveIntensity=.5+r*2)}),u.jsxs("mesh",{ref:t,position:[0,0,0],children:[u.jsx("sphereGeometry",{args:[1.5,64,64]}),u.jsx("meshPhysicalMaterial",{color:"#7c3aed",emissive:"#4c1d95",roughness:.2,metalness:.8,clearcoat:1,clearcoatRoughness:.1})]})},ae=()=>{const d=I(a=>a.startWarp),[c,t]=e.useState("demo"),o=X(c),{playClick:m,playHover:r}=z();return u.jsxs("group",{children:[u.jsx("color",{attach:"background",args:["#020617"]}),u.jsx("fogExp2",{attach:"fog",args:["#020617",.04]}),u.jsx(T,{preset:"city"}),u.jsx(D,{children:u.jsx(N,{position:[0,6,-5],fontSize:.6,color:"#d8b4fe",anchorX:"center",children:"SONIC GIANT [HARMONICS]"})}),u.jsx(W,{position:[0,3.5,0],center:!0,transform:!0,distanceFactor:5,style:{pointerEvents:"auto"},children:u.jsxs("div",{className:"flex gap-4 p-4 bg-black/80 rounded-xl border border-purple-500/30 backdrop-blur-md shadow-[0_0_30px_rgba(139,92,246,0.3)]",style:{pointerEvents:"auto"},children:[u.jsx("button",{onClick:()=>{m(),t("demo")},onPointerEnter:r,className:`px-4 py-1 rounded font-mono text-xs transition-all cursor-pointer ${c==="demo"?"bg-purple-600 text-white shadow-[0_0_15px_#7c3aed]":"text-purple-500 hover:bg-purple-900/50"}`,children:"DEMO_FREQUENCY"}),u.jsx("button",{onClick:()=>{m(),t("mic")},onPointerEnter:r,className:`px-4 py-1 rounded font-mono text-xs transition-all cursor-pointer ${c==="mic"?"bg-cyan-600 text-white shadow-[0_0_15px_#0891b2]":"text-cyan-500 hover:bg-cyan-900/50"}`,children:"LIVE_INPUT"}),u.jsx("button",{onClick:()=>{m(),d("hub")},onPointerEnter:r,className:"px-4 py-1 rounded font-mono text-xs border border-white/30 text-white/70 hover:bg-white/10 hover:border-white/50 hover:text-white transition-all shadow-lg cursor-pointer bg-black/50",children:"[ WARP TO NEXUS ]"})]})}),u.jsxs(B,{speed:2,rotationIntensity:.2,floatIntensity:.5,children:[u.jsx(Q,{analyser:o,mode:c}),u.jsx(Y,{analyser:o,mode:c})]}),u.jsx(Z,{analyser:o,mode:c}),u.jsx(V,{analyser:o,mode:c}),u.jsx("gridHelper",{args:[50,50,8141549,1973067],position:[0,-4,0]})]})};export{ae as default};
